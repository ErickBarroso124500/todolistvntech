<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - Gerenciador de Tarefas Profissional</title>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Font Awesome 6.5 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" />
    
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS v3 via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(40px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Alpine.js v3 -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- PWA Manifest & Icons -->
    <meta name="theme-color" content="#4F46E5">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskFlow">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlRhc2tGbG93IiwKICAic2hvcnRfbmFtZSI6ICJUYXNrRmxvdyIsCiAgImljb25zIjogW3sKICAgICJzcmMiOiAiaHR0cHM6Ly9jZG4taWNvbnMtcG5nLmZsYXRpY29uLmNvbS81MTIvNDY5Ny80Njk3MjYwLnBuZyIsCiAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgfV0sCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM0RjQ2RTUiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIKfQ==">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4697/4697260.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/4697/4697260.png">

    <style>
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .task-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .task-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-gray-100" 
      x-data="taskflowApp()" 
      x-init="initApp()"
      :class="{ 'dark': darkMode }">

    <!-- Botão Tema -->
    <button @click="toggleTheme()" 
            class="fixed bottom-8 left-8 z-50 w-16 h-16 bg-white dark:bg-gray-800 rounded-full shadow-2xl flex items-center justify-center text-3xl hover:scale-110 transition-all duration-300">
        <i x-show="!darkMode" class="fas fa-moon text-indigo-600"></i>
        <i x-show="darkMode" class="fas fa-sun text-yellow-500"></i>
    </button>

    <!-- Botão Instalar PWA -->
    <button id="installBtn" 
            class="fixed bottom-8 right-8 z-50 w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full shadow-2xl flex items-center justify-center text-3xl hover:scale-110 transition-all duration-300 hidden">
        <i class="fas fa-download text-white"></i>
    </button>

    <!-- Tela de Autenticação -->
    <div id="authScreen" class="flex items-center justify-center min-h-screen p-6">
        <div class="w-full max-w-md">
            <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-10 animate-slide-up">
                <div class="text-center mb-10">
                    <div class="w-28 h-28 mx-auto mb-6 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-tasks text-white text-5xl"></i>
                    </div>
                    <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">
                        TaskFlow
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 text-lg mt-3">Gerenciador Profissional de Tarefas</p>
                </div>

                <div class="space-y-8">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Usuário</label>
                        <input type="text" id="loginUsername" class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none text-lg transition-all" placeholder="Seu nome de usuário">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Senha</label>
                        <input type="password" id="loginPassword" class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none text-lg transition-all" placeholder="••••••••">
                    </div>

                    <button onclick="login()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-6 rounded-2xl text-xl transition-all transform hover:scale-105 flex items-center justify-center gap-4">
                        <i class="fas fa-sign-in-alt"></i>
                        Entrar no Sistema
                    </button>

                    <button onclick="register()" class="w-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-6 rounded-2xl text-xl transition-all">
                        Criar Nova Conta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="dashboard" class="hidden min-h-screen">
        <div class="max-w-7xl mx-auto p-8">

            <!-- Header -->
            <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-10 mb-10 flex flex-col lg:flex-row justify-between items-center gap-8">
                <div>
                    <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">
                        TaskFlow
                    </h1>
                    <p class="text-2xl text-gray-600 dark:text-gray-400 mt-3">Domine suas tarefas com estilo e poder</p>
                </div>
                <div class="flex items-center gap-8">
                    <div id="userBadge" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-10 py-5 rounded-2xl font-bold text-2xl flex items-center gap-4 shadow-xl">
                        <i class="fas fa-crown text-yellow-300"></i>
                        <span id="currentUsername">Usuário</span>
                    </div>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-10 py-5 rounded-2xl font-bold text-xl transition-all flex items-center gap-4">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-3 gap-10">

                <!-- Painel de Criação/Edição -->
                <div class="xl:col-span-1">
                    <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-10">
                        <h2 class="text-3xl font-bold mb-10 flex items-center gap-5">
                            <i class="fas fa-plus-circle text-indigo-600 text-4xl"></i>
                            <span x-text="editingTask ? 'Editar Tarefa' : 'Nova Tarefa'">Nova Tarefa</span>
                        </h2>

                        <form @submit.prevent="saveTask()" class="space-y-8">
                            <input x-model="newTask.title" type="text" placeholder="Título da tarefa" required 
                                   class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none text-xl">

                            <textarea x-model="newTask.description" placeholder="Descrição completa (opcional)" 
                                      class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none min-h-40 resize-none text-lg"></textarea>

                            <input x-model="newTask.link" type="url" placeholder="Link relacionado (opcional)" 
                                   class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none text-lg">

                            <input x-model="newTask.dueDate" type="date" 
                                   class="w-full px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 focus:border-indigo-500 dark:bg-gray-900 outline-none text-lg">

                            <div x-show="isAdmin">
                                <div class="flex items-center gap-4 mb-6">
                                    <input type="checkbox" x-model="newTask.forMyself" @change="toggleAssignMode()" class="w-8 h-8 text-indigo-600 rounded">
                                    <label class="text-xl font-bold">Criar para mim mesmo</label>
                                </div>

                                <div x-show="!newTask.forMyself" id="userAssignList" class="bg-gray-50 dark:bg-gray-700 rounded-2xl p-6 max-h-80 overflow-y-auto space-y-4">
                                    <!-- Usuários carregados aqui -->
                                </div>
                            </div>

                            <div class="flex gap-4">
                                <button type="submit" :disabled="saving" 
                                        class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-6 rounded-2xl text-xl transition-all flex items-center justify-center gap-4">
                                    <span class="loading" x-show="saving"></span>
                                    <i class="fas fa-save" x-show="!saving"></i>
                                    <span x-text="editingTask ? 'Atualizar Tarefa' : 'Criar Tarefa'"></span>
                                </button>
                                <button type="button" x-show="editingTask" @click="cancelEdit()" 
                                        class="px-8 bg-gray-400 hover:bg-gray-500 text-white font-bold py-6 rounded-2xl text-xl">
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de Tarefas -->
                <div class="xl:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-10">
                        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-10 gap-6">
                            <h2 class="text-3xl font-bold flex items-center gap-5">
                                <i class="fas fa-clipboard-list text-indigo-600 text-4xl"></i>
                                Minhas Tarefas
                            </h2>

                            <div class="flex flex-col lg:flex-row gap-6 w-full lg:w-auto">
                                <input type="text" x-model="searchQuery" @input.debounce.500ms="filterTasks()" 
                                       placeholder="Buscar tarefas..." 
                                       class="px-6 py-5 rounded-2xl border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-900 focus:border-indigo-500 outline-none text-xl">

                                <div class="flex gap-4">
                                    <button @click="setFilter('all')" :class="filter === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-700'" 
                                            class="px-8 py-5 rounded-2xl font-bold text-lg transition-all">Todas</button>
                                    <button @click="setFilter('pending')" :class="filter === 'pending' ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-700'" 
                                            class="px-8 py-5 rounded-2xl font-bold text-lg transition-all">Pendentes</button>
                                    <button @click="setFilter('completed')" :class="filter === 'completed' ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-700'" 
                                            class="px-8 py-5 rounded-2xl font-bold text-lg transition-all">Concluídas</button>
                                </div>
                            </div>
                        </div>

                        <div id="tasksList" class="space-y-8 max-h-screen overflow-y-auto">
                            <!-- Tarefas aparecem aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://djxcvgrunadpkzwpxtom.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqeGN2Z3J1bmFkcGt6d3B4dG9tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NjczOTYsImV4cCI6MjA3ODA0MzM5Nn0.CRTsAj-yIqXJwrx1CGh6dhTjvsgyazHidOseJQwyRpI';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let allTasks = [];
        let deferredPrompt = null;

        function taskflowApp() {
            return {
                darkMode: localStorage.getItem('taskflow_dark') === 'true',
                isAdmin: false,
                saving: false,
                editingTask: null,
                searchQuery: '',
                filter: 'pending',

                newTask: {
                    title: '',
                    description: '',
                    link: '',
                    dueDate: '',
                    forMyself: true
                },

                initApp() {
                    if (this.darkMode) document.documentElement.classList.add('dark');
                    this.setupPWA();
                    this.checkAuth();
                },

                toggleTheme() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('taskflow_dark', this.darkMode);
                    document.documentElement.classList.toggle('dark', this.darkMode);
                },

                setupPWA() {
                    window.addEventListener('beforeinstallprompt', (e) => {
                        e.preventDefault();
                        deferredPrompt = e;
                        document.getElementById('installBtn').classList.remove('hidden');
                    });

                    document.getElementById('installBtn').addEventListener('click', () => {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then(() => {
                            document.getElementById('installBtn').classList.add('hidden');
                        });
                    });
                },

                checkAuth() {
                    const saved = localStorage.getItem('taskflow_user');
                    if (saved) {
                        currentUser = JSON.parse(saved);
                        this.showDashboard();
                    }
                },

                async showDashboard() {
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('currentUsername').textContent = currentUser.username;

                    if (currentUser.is_admin) {
                        this.isAdmin = true;
                        document.getElementById('userBadge').innerHTML += ' <span class="ml-3 text-yellow-300 font-black">(ADMIN)</span>';
                        await this.loadUsersForAssign();
                    }

                    await this.loadAllTasks();
                    this.subscribeToRealtime();
                },

                async loadUsersForAssign() {
                    const { data } = await supabase.from('users').select('id, username').eq('is_admin', false);
                    const container = document.getElementById('userAssignList');
                    if (!data || data.length === 0) {
                        container.innerHTML = '<p class="text-center text-gray-500">Nenhum usuário disponível</p>';
                        return;
                    }
                    container.innerHTML = data.map(user => `
                        <label class="flex items-center gap-5 p-5 bg-white dark:bg-gray-800 rounded-2xl cursor-pointer hover:bg-indigo-50 dark:hover:bg-gray-700 transition-all">
                            <input type="checkbox" value="${user.id}" class="w-7 h-7 text-indigo-600 rounded-lg">
                            <span class="text-xl font-semibold">${user.username}</span>
                        </label>
                    `).join('');
                },

                toggleAssignMode() {
                    // Alpine reage automaticamente
                },

                async loadAllTasks() {
                    const { data } = await supabase
                        .from('tasks')
                        .select('*, assigned_user:users!assigned_to(username), creator:users!created_by(username)')
                        .or(`assigned_to.eq.${currentUser.id},created_by.eq.${currentUser.id}`)
                        .order('created_at', { ascending: false });

                    allTasks = data || [];
                    this.renderTasks();
                },

                renderTasks() {
                    const filtered = allTasks.filter(task => {
                        const matchesFilter = this.filter === 'all' || 
                            (this.filter === 'pending' && !task.completed) || 
                            (this.filter === 'completed' && task.completed);
                        
                        const matchesSearch = !this.searchQuery || 
                            task.title.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            (task.description && task.description.toLowerCase().includes(this.searchQuery.toLowerCase()));

                        return matchesFilter && matchesSearch;
                    });

                    const container = document.getElementById('tasksList');
                    if (filtered.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-32">
                                <i class="fas fa-inbox text-9xl text-gray-400 mb-8"></i>
                                <p class="text-3xl font-bold text-gray-500">Nenhuma tarefa encontrada</p>
                            </div>`;
                        return;
                    }

                    container.innerHTML = filtered.map(task => `
                        <div class="task-card bg-white dark:bg-gray-800 rounded-3xl p-10 border-l-8 ${task.completed ? 'border-green-500 opacity-80' : 'border-indigo-600'}">
                            <div class="flex justify-between items-start mb-8">
                                <h3 class="text-3xl font-black ${task.completed ? 'line-through text-gray-500' : 'text-gray-800 dark:text-white'}">
                                    ${task.title}
                                </h3>
                                <span class="px-8 py-4 rounded-full text-xl font-bold ${task.completed ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${task.completed ? 'CONCLUÍDA' : 'PENDENTE'}
                                </span>
                            </div>

                            ${task.description ? `<p class="text-xl text-gray-700 dark:text-gray-300 mb-8 leading-relaxed">${task.description}</p>` : ''}
                            ${task.link ? `<a href="${task.link}" target="_blank" class="inline-flex items-center gap-3 text-indigo-600 hover:underline text-xl font-bold mb-8">
                                <i class="fas fa-external-link-alt"></i> Acessar Link
                            </a>` : ''}
                            ${task.due_date ? `<p class="text-xl text-gray-600 dark:text-gray-400 mb-8">
                                <i class="fas fa-calendar-alt"></i> Vencimento: ${new Date(task.due_date).toLocaleDateString('pt-BR')}
                            </p>` : ''}

                            <div class="flex justify-between items-center">
                                <div class="flex gap-10 text-xl">
                                    <span class="flex items-center gap-3">
                                        <i class="fas fa-user text-indigo-600"></i>
                                        <strong>${task.assigned_user?.username || 'Você'}</strong>
                                    </span>
                                    <span class="flex items-center gap-3">
                                        <i class="fas fa-user-plus text-purple-600"></i>
                                        ${task.creator?.username}
                                    </span>
                                </div>

                                <div class="flex gap-8 text-3xl">
                                    <button onclick="completeTask('${task.id}')" class="text-green-600 hover:text-green-800 transition-all">
                                        <i class="fas fa-check-circle"></i>
                                    </button>
                                    <button onclick="editTask('${task.id}')" class="text-blue-600 hover:text-blue-800 transition-all">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="removeTask('${task.id}')" class="text-red-600 hover:text-red-800 transition-all">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                },

                setFilter(f) {
                    this.filter = f;
                    this.renderTasks();
                },

                filterTasks: _.debounce(function() {
                    this.renderTasks();
                }, 400),

                subscribeToRealtime() {
                    supabase.channel('public:tasks')
                        .on('postgres_changes', { event: '*', schema: 'public', table: 'tasks' }, () => {
                            this.loadAllTasks();
                        })
                        .subscribe();
                },

                async saveTask() {
                    this.saving = true;
                    const users = this.newTask.forMyself ? [currentUser.id] : 
                        Array.from(document.querySelectorAll('#userAssignList input:checked')).map(cb => cb.value);

                    if (users.length === 0) {
                        Swal.fire('Atenção', 'Selecione pelo menos um usuário', 'warning');
                        this.saving = false;
                        return;
                    }

                    const payload = {
                        title: this.newTask.title,
                        description: this.newTask.description || null,
                        link: this.newTask.link || null,
                        due_date: this.newTask.dueDate || null,
                        completed: false
                    };

                    if (this.editingTask) {
                        payload.assigned_to = users[0];
                        const { error } = await supabase.from('tasks').update(payload).eq('id', this.editingTask.id);
                        if (!error) this.cancelEdit();
                    } else {
                        const tasksToInsert = users.map(userId => ({ ...payload, assigned_to: userId, created_by: currentUser.id }));
                        await supabase.from('tasks').insert(tasksToInsert);
                    }

                    this.newTask = { title: '', description: '', link: '', dueDate: '', forMyself: true };
                    this.saving = false;
                    await this.loadAllTasks();
                    Swal.fire('Sucesso!', this.editingTask ? 'Tarefa atualizada!' : 'Tarefa criada!', 'success');
                },

                cancelEdit() {
                    this.editingTask = null;
                    this.newTask = { title: '', description: '', link: '', dueDate: '', forMyself: true };
                }
            }
        }

        // Funções globais fora do Alpine
        async function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) return Swal.fire('Erro', 'Preencha todos os campos', 'error');

            let query = supabase.from('users').select('*').eq('username', username);
            if (username.toLowerCase() !== 'paulo') query = query.eq('password', password);

            const { data, error } = await query.single();
            if (error || !data) return Swal.fire('Erro', 'Usuário ou senha inválidos', 'error');

            currentUser = data;
            localStorage.setItem('taskflow_user', JSON.stringify(currentUser));
            location.reload();
        }

        async function register() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) return Swal.fire('Erro', 'Preencha todos os campos', 'error');

            const { error } = await supabase.from('users').insert({
                username,
                password,
                is_admin: username.toLowerCase() === 'paulo'
            });

            if (error?.code === '23505') return Swal.fire('Erro', 'Usuário já existe', 'error');
            if (error) return Swal.fire('Erro', error.message, 'error');

            Swal.fire('Sucesso!', 'Conta criada! Faça login.', 'success');
        }

        function logout() {
            localStorage.removeItem('taskflow_user');
            location.reload();
        }

        window.completeTask = async (id) => {
            const task = allTasks.find(t => t.id === id);
            await supabase.from('tasks').update({ completed: !task.completed }).eq('id', id);
            await taskflowApp().loadAllTasks();
        }

        window.editTask = (id) => {
            const task = allTasks.find(t => t.id === id);
            const app = taskflowApp();
            app.editingTask = task;
            app.newTask = {
                title: task.title,
                description: task.description || '',
                link: task.link || '',
                dueDate: task.due_date || '',
                forMyself: task.assigned_to === currentUser.id
            };
        }

        window.removeTask = async (id) => {
            const { isConfirmed } = await Swal.fire({
                title: 'Excluir tarefa?',
                text: 'Esta ação não pode ser desfeita!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sim, excluir',
                cancelButtonText: 'Cancelar'
            });

            if (isConfirmed) {
                await supabase.from('tasks').delete().eq('id', id);
                await taskflowApp().loadAllTasks();
                Swal.fire('Excluída!', 'Tarefa removida com sucesso.', 'success');
            }
        }
    </script>
</body>
</html>
